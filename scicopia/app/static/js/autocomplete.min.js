function autocomplete(inp){let currentFocus;inp.addEventListener("input",function(){query_es(this);});inp.addEventListener("keydown",function(e){let x=document.getElementById(this.id+"-autocomplete-list");if(x)x=x.getElementsByTagName("div");if(e.keyCode==40){currentFocus++;addActive(x);}else if(e.keyCode==38){currentFocus--;addActive(x);}else if(e.keyCode==13){if(currentFocus>-1){e.preventDefault();if(x)x[currentFocus].click();currentFocus=-1;}}});function addActive(x){if(!x)return false;removeActive(x);if(currentFocus>=x.length)currentFocus=0;if(currentFocus<0)currentFocus=(x.length-1);x[currentFocus].classList.add("autocomplete-active");}
function removeActive(x){for(let i=0;i<x.length;i++){x[i].classList.remove("autocomplete-active");}}
function closeAllLists(elmnt){let x=document.getElementsByClassName("autocomplete-items");for(let i=0;i<x.length;i++){if(elmnt!=x[i]&&elmnt!=inp){x[i].parentNode.removeChild(x[i]);}}}
document.addEventListener("click",function(e){closeAllLists(e.target);});function query_es(elem){let user_input=elem.value;if(!user_input){return;}
let xhr=new XMLHttpRequest();xhr.open("POST","/autocomplete",true);xhr.responseType="json";xhr.setRequestHeader('content-type','application/x-www-form-urlencoded;charset=UTF-8');xhr.onload=function(){let json=xhr.response;if(typeof json==="undefined"){console.log('Auto-completion response empty.');return;}
let suggestions=json['completions'];if(typeof suggestions==="undefined"){console.log('There were no sugggestions.');return;}
let prefix=json['prefix'];let term=json['term'];let a,b,i;closeAllLists();if(!term){return false;}
currentFocus=-1;a=document.createElement("DIV");a.setAttribute("id",elem.id+"-autocomplete-list");a.setAttribute("class","autocomplete-items");elem.parentNode.appendChild(a);for(i=0;i<suggestions.length;i++){b=document.createElement("DIV");if(suggestions[i].substr(0,term.length).toUpperCase()==term.toUpperCase()){b.innerHTML=prefix+"<strong>"+suggestions[i].substr(0,term.length)+"</strong>";b.innerHTML+=suggestions[i].substr(term.length);}else{b.innerHTML=prefix+suggestions[i];}
b.innerHTML+="<input type='hidden' value='"+prefix+suggestions[i]+"'>";b.addEventListener("click",function(){elem.value=this.getElementsByTagName("input")[0].value;closeAllLists();});a.appendChild(b);}
return suggestions;}
xhr.send("prefix="+user_input);}}